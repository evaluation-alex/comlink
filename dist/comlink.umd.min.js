(function(a){if("object"==typeof module&&"object"==typeof module.exports){var b=a(require,exports);b!==void 0&&(module.exports=b)}else"function"==typeof define&&define.amd&&define(["require","exports"],a)})(function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0}),b.Comlink=function(){function a(b){if(k(b)&&(b=e(b)),!f(b))throw Error("endpoint does not have all of addEventListener, removeEventListener and postMessage defined");return g(b),n(async(c)=>{let e=[];("APPLY"===c.type||"CONSTRUCT"===c.type)&&(e=c.argumentsList=c.argumentsList.map((a)=>{if(!r(a))return a;const{port1:b,port2:c}=new MessageChannel;return d(a,b),{[x]:"PROXY",endpoint:c}}));const f=await l(b,c,q(e)),g=f.data;return"PROXY"===g.type?a(g.endpoint):g.obj})}function c(a){return a[w]=!0,a}function d(a,d){if(k(d)&&(d=e(d)),!f(d))throw Error("endpoint does not have all of addEventListener, removeEventListener and postMessage defined");g(d),h(d,async function(e){if(!e.data.id)return;const f=e.data;let g=await f.callPath.slice(0,-1).reduce((a,b)=>a[b],a),h=await f.callPath.reduce((a,b)=>a[b],a);const i="AsyncGeneratorFunction"===h.constructor.name;let j=h;return"argumentsList"in f&&(f.argumentsList=f.argumentsList.map((a)=>{return"PROXY"===a[x]?b.Comlink.proxy(a.endpoint):a})),"APPLY"===f.type&&(j=await h.apply(g,f.argumentsList)),i&&(j=c(j)),"CONSTRUCT"===f.type&&(j=c(new h(...(f.argumentsList||[])))),"SET"===f.type&&(h[f.property]=f.value,j=!0),j=s(j),j.id=f.id,d.postMessage(j,q([j]))})}function e(a){if("Window"!==self.constructor.name)throw Error("self is not a window");return{addEventListener:self.addEventListener.bind(self),removeEventListener:self.removeEventListener.bind(self),postMessage:(b,c)=>a.postMessage(b,"*",c)}}function f(a){return"addEventListener"in a&&"removeEventListener"in a&&"postMessage"in a}function g(a){j(a)&&a.start()}function h(a,b){a.addEventListener("message",b)}function i(a,b){a.removeEventListener("message",b)}function j(a){return"MessagePort"===a.constructor.name}function k(a){return["window","length","location","parent","opener"].every((b)=>b in a)}function l(a,b,c){const d=`${t}-${u++}`;return new Promise((e)=>{h(a,function b(c){c.data.id!==d||(i(a,b),e(c))}),b=Object.assign({},b,{id:d}),a.postMessage(b,c)})}function m(){return"asyncIterator"in Symbol}function n(a){let b=[];return new Proxy(function(){},{construct(c,d){const e=a({type:"CONSTRUCT",callPath:b,argumentsList:d});return b=[],e},apply(c,d,e){if("bind"===b[b.length-1]){const c=b.slice();return b=[],(...b)=>a({type:"APPLY",callPath:c.slice(0,-1),argumentsList:b})}const f=a({type:"APPLY",callPath:b,argumentsList:e});return b=[],f},get(c,d,e){if("then"===d&&0===b.length)return{then:()=>e};if(m()&&d===Symbol.asyncIterator)return()=>e;if("then"===d){const c=a({type:"GET",callPath:b});return b=[],Promise.resolve(c).then.bind(c)}return b.push(d),e},set(c,d,e){return a({type:"SET",callPath:b,property:d,value:e})}})}function o(a){return v.some((b)=>a instanceof b)}function*p(a){if(!a)return;if("string"==typeof a)return;yield a;let b=Object.values(a);Array.isArray(a)&&(b=a);for(const c of b)yield*p(c)}function q(a){const b=[];for(const c of p(a))o(c)&&b.push(c);return b}function r(a){return a&&a[w]}function s(a){if(r(a)){const{port1:b,port2:c}=new MessageChannel;return d(a,b),{type:"PROXY",endpoint:c}}return{type:"OBJECT",obj:a}}const t=Math.floor(Math.random()*Number.MAX_SAFE_INTEGER);let u=0;const v=[ArrayBuffer,MessagePort],w=Symbol("proxyValue"),x="__omg_so_secret";return{proxy:a,proxyValue:c,expose:d}}()});
